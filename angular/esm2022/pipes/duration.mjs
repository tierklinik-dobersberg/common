import { Duration as ProtoDuration } from '@bufbuild/protobuf';
import { padLeft } from './utils';
const nanosecond = 1;
const microsecond = 1000 * nanosecond;
const millisecond = 1000 * microsecond;
const second = 1000 * millisecond;
const minute = 60 * second;
const hour = 60 * minute;
const day = 24 * hour;
class Duration {
    constructor(ns) {
        this._nanoseconds = ns;
    }
    toProto() {
        return new ProtoDuration({
            seconds: BigInt(this.seconds),
        });
    }
    get nanoseconds() {
        return this._nanoseconds;
    }
    get microseconds() {
        return Math.floor(this._nanoseconds / microsecond);
    }
    get milliseconds() {
        return Math.floor(this._nanoseconds / millisecond);
    }
    get seconds() {
        return Math.floor(this._nanoseconds / second);
    }
    get minutes() {
        return Math.floor(this._nanoseconds / minute);
    }
    get hours() {
        return Math.floor(this._nanoseconds / hour);
    }
    static { this.nanosecond = new Duration(nanosecond); }
    static { this.microsecond = new Duration(microsecond); }
    static { this.millisecond = new Duration(millisecond); }
    static { this.second = new Duration(second); }
    static { this.minute = new Duration(minute); }
    static { this.hour = new Duration(hour); }
    static nanoseconds(s) {
        return new Duration(s * nanosecond);
    }
    static microseconds(s) {
        return new Duration(s * microsecond);
    }
    static milliseconds(s) {
        return new Duration(s * millisecond);
    }
    static seconds(s) {
        return new Duration(s * second);
    }
    static minutes(s) {
        return new Duration(s * minute);
    }
    static hours(s) {
        return new Duration(s * hour);
    }
    addTo(d) {
        return new Date(d.getTime() + this.milliseconds);
    }
    format(layout = 'default') {
        if (layout === 'default' || layout === 'default-hours') {
            return this.toString(layout === 'default-hours');
        }
        const sign = this._nanoseconds < 0 ? '-' : '';
        let ns = Math.abs(this._nanoseconds);
        const hours = Math.floor(ns / hour);
        ns -= hours * hour;
        const minutes = Math.floor(ns / minute);
        ns -= minutes * minute;
        const seconds = Math.floor(ns / second);
        ns -= seconds * second;
        let str = padLeft(hours.toString(), 2, '0') + ':' + padLeft(minutes.toString(), 2, '0');
        if (layout === 'hh:mm:ss') {
            str += ':' + padLeft(seconds.toString(), 2, '0');
        }
        return sign + str;
    }
    toString(skipDays = false) {
        const sign = this._nanoseconds < 0 ? '-' : '';
        let ns = Math.abs(this._nanoseconds);
        let str = '';
        if (this._nanoseconds === 0) {
            return '0h';
        }
        if (!skipDays) {
            const days = Math.floor(ns / day);
            if (days > 0) {
                str += days.toString() + 'd ';
                ns -= days * day;
            }
        }
        const hours = Math.floor(ns / hour);
        if (hours > 0) {
            str += hours.toString() + 'h ';
            ns -= hours * hour;
        }
        const minutes = Math.floor(ns / minute);
        if (minutes > 0) {
            str += minutes.toString() + 'm ';
            ns -= minutes * minute;
        }
        const seconds = Math.floor(ns / second);
        if (seconds > 0) {
            str += seconds.toString() + 's ';
            ns -= seconds * second;
        }
        const milliseconds = Math.floor(ns / millisecond);
        if (milliseconds > 0) {
            str += milliseconds.toString() + 'ms ';
            ns -= milliseconds * millisecond;
        }
        const microseconds = Math.floor(ns / microsecond);
        if (microseconds > 0) {
            str += microseconds.toString() + 'µs ';
            ns -= microseconds * microsecond;
        }
        if (ns > 0) {
            str += ns.toString() + 'ns';
            ns -= ns * nanosecond;
        }
        if (str.endsWith("")) {
            str = str.substring(0, str.length - 1);
        }
        return sign + str;
    }
    static parseString(v) {
        let time = 0;
        let numberValue = '';
        let suffix = '';
        let state = 'number';
        let parseFactor = 1;
        const parse = () => {
            let factor = 0;
            switch (suffix) {
                case 'd':
                    factor = day;
                    break;
                case 'h':
                    factor = hour;
                    break;
                case 'm':
                    factor = minute;
                    break;
                case 's':
                    factor = second;
                    break;
                case 'ms':
                    factor = millisecond;
                    break;
                case 'µs':
                    factor = microsecond;
                    break;
                case 'ns':
                    factor = nanosecond;
                    break;
                default:
                    throw new Error(`invalid time factor: ${suffix}`);
            }
            time += ((+numberValue) * factor);
        };
        try {
            for (let i = 0; i < v.length; i++) {
                const c = v.charAt(i);
                if (c === ' ') {
                    continue;
                }
                if (c === '-' && numberValue === '') {
                    parseFactor = -1;
                    continue;
                }
                if (state === 'number') {
                    if (!isNaN(+c)) {
                        numberValue += c;
                        continue;
                    }
                    state = 'suffix';
                    suffix += c;
                    continue;
                }
                if (state === 'suffix') {
                    if (isNaN(+c)) {
                        suffix += c;
                        continue;
                    }
                    parse();
                    numberValue = c;
                    suffix = '';
                    state = 'number';
                }
            }
            if (numberValue !== '') {
                parse();
            }
            return new Duration(parseFactor * time);
        }
        catch (err) {
            return new Duration(0);
        }
    }
    isLessThan(d) {
        return this.nanoseconds < d.nanoseconds;
    }
    isGreatherThan(d) {
        return this.nanoseconds > d.nanoseconds;
    }
    isEqual(d) {
        return this.nanoseconds === d.nanoseconds;
    }
    valueOf() {
        return this._nanoseconds;
    }
}
export { Duration };
export function formatDate(d, sep = '-') {
    if (d === null) {
        return '';
    }
    d = new Date(d);
    let month = '' + (d.getMonth() + 1);
    let day = '' + d.getDate();
    let year = d.getFullYear();
    if (month.length < 2)
        month = '0' + month;
    if (day.length < 2)
        day = '0' + day;
    return [year, month, day].join(sep);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHVyYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9kZXYvY29tcG9uZW50cy9waXBlcy9kdXJhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxJQUFJLGFBQWEsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQy9ELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFbEMsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDO0FBQ3JCLE1BQU0sV0FBVyxHQUFHLElBQUksR0FBRyxVQUFVLENBQUM7QUFDdEMsTUFBTSxXQUFXLEdBQUcsSUFBSSxHQUFHLFdBQVcsQ0FBQztBQUN2QyxNQUFNLE1BQU0sR0FBRyxJQUFJLEdBQUcsV0FBVyxDQUFDO0FBQ2xDLE1BQU0sTUFBTSxHQUFHLEVBQUUsR0FBRyxNQUFNLENBQUM7QUFDM0IsTUFBTSxJQUFJLEdBQUcsRUFBRSxHQUFHLE1BQU0sQ0FBQztBQUN6QixNQUFNLEdBQUcsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO0FBSXRCLE1BQWEsUUFBUTtJQUNuQixZQUFZLEVBQVU7UUFDcEIsSUFBSSxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUVELE9BQU87UUFDTCxPQUFPLElBQUksYUFBYSxDQUFDO1lBQ3ZCLE9BQU8sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztTQUM5QixDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsSUFBSSxXQUFXO1FBQ2IsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzNCLENBQUM7SUFFRCxJQUFJLFlBQVk7UUFDZCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRyxXQUFXLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsSUFBSSxZQUFZO1FBQ2QsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLEdBQUcsV0FB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QUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUNoQixHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUVsQixPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDdEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IER1cmF0aW9uIGFzIFByb3RvRHVyYXRpb24gfSBmcm9tICdAYnVmYnVpbGQvcHJvdG9idWYnO1xuaW1wb3J0IHsgcGFkTGVmdCB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBuYW5vc2Vjb25kID0gMTtcbmNvbnN0IG1pY3Jvc2Vjb25kID0gMTAwMCAqIG5hbm9zZWNvbmQ7XG5jb25zdCBtaWxsaXNlY29uZCA9IDEwMDAgKiBtaWNyb3NlY29uZDtcbmNvbnN0IHNlY29uZCA9IDEwMDAgKiBtaWxsaXNlY29uZDtcbmNvbnN0IG1pbnV0ZSA9IDYwICogc2Vjb25kO1xuY29uc3QgaG91ciA9IDYwICogbWludXRlO1xuY29uc3QgZGF5ID0gMjQgKiBob3VyO1xuXG5leHBvcnQgdHlwZSBEdXJhdGlvbkxheW91dCA9ICdkZWZhdWx0LWhvdXJzJyB8ICdkZWZhdWx0JyB8ICdoaDptbScgfCAnaGg6bW06c3MnO1xuXG5leHBvcnQgY2xhc3MgRHVyYXRpb24ge1xuICBjb25zdHJ1Y3RvcihuczogbnVtYmVyKSB7XG4gICAgdGhpcy5fbmFub3NlY29uZHMgPSBucztcbiAgfVxuXG4gIHRvUHJvdG8oKTogUHJvdG9EdXJhdGlvbiB7XG4gICAgcmV0dXJuIG5ldyBQcm90b0R1cmF0aW9uKHtcbiAgICAgIHNlY29uZHM6IEJpZ0ludCh0aGlzLnNlY29uZHMpLFxuICAgIH0pXG4gIH1cblxuICBnZXQgbmFub3NlY29uZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX25hbm9zZWNvbmRzO1xuICB9XG5cbiAgZ2V0IG1pY3Jvc2Vjb25kcygpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLl9uYW5vc2Vjb25kcyAvIG1pY3Jvc2Vjb25kKTtcbiAgfVxuXG4gIGdldCBtaWxsaXNlY29uZHMoKSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy5fbmFub3NlY29uZHMgLyBtaWxsaXNlY29uZCk7XG4gIH1cblxuICBnZXQgc2Vjb25kcygpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLl9uYW5vc2Vjb25kcyAvIHNlY29uZCk7XG4gIH1cblxuICBnZXQgbWludXRlcygpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLl9uYW5vc2Vjb25kcyAvIG1pbnV0ZSk7XG4gIH1cblxuICBnZXQgaG91cnMoKSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy5fbmFub3NlY29uZHMgLyBob3VyKTtcbiAgfVxuXG4gIHN0YXRpYyBuYW5vc2Vjb25kID0gbmV3IER1cmF0aW9uKG5hbm9zZWNvbmQpO1xuICBzdGF0aWMgbWljcm9zZWNvbmQgPSBuZXcgRHVyYXRpb24obWljcm9zZWNvbmQpO1xuICBzdGF0aWMgbWlsbGlzZWNvbmQgPSBuZXcgRHVyYXRpb24obWlsbGlzZWNvbmQpO1xuICBzdGF0aWMgc2Vjb25kID0gbmV3IER1cmF0aW9uKHNlY29uZCk7XG4gIHN0YXRpYyBtaW51dGUgPSBuZXcgRHVyYXRpb24obWludXRlKTtcbiAgc3RhdGljIGhvdXIgPSBuZXcgRHVyYXRpb24oaG91cik7XG4gIHByaXZhdGUgX25hbm9zZWNvbmRzOiBudW1iZXI7XG5cbiAgc3RhdGljIG5hbm9zZWNvbmRzKHM6IG51bWJlcik6IER1cmF0aW9uIHtcbiAgICByZXR1cm4gbmV3IER1cmF0aW9uKHMgKiBuYW5vc2Vjb25kKTtcbiAgfVxuICBzdGF0aWMgbWljcm9zZWNvbmRzKHM6IG51bWJlcik6IER1cmF0aW9uIHtcbiAgICByZXR1cm4gbmV3IER1cmF0aW9uKHMgKiBtaWNyb3NlY29uZCk7XG4gIH1cbiAgc3RhdGljIG1pbGxpc2Vjb25kcyhzOiBudW1iZXIpOiBEdXJhdGlvbiB7XG4gICAgcmV0dXJuIG5ldyBEdXJhdGlvbihzICogbWlsbGlzZWNvbmQpO1xuICB9XG4gIHN0YXRpYyBzZWNvbmRzKHM6IG51bWJlcik6IER1cmF0aW9uIHtcbiAgICByZXR1cm4gbmV3IER1cmF0aW9uKHMgKiBzZWNvbmQpO1xuICB9XG4gIHN0YXRpYyBtaW51dGVzKHM6IG51bWJlcik6IER1cmF0aW9uIHtcbiAgICByZXR1cm4gbmV3IER1cmF0aW9uKHMgKiBtaW51dGUpO1xuICB9XG4gIHN0YXRpYyBob3VycyhzOiBudW1iZXIpOiBEdXJhdGlvbiB7XG4gICAgcmV0dXJuIG5ldyBEdXJhdGlvbihzICogaG91cik7XG4gIH1cblxuICBhZGRUbyhkOiBEYXRlKTogRGF0ZSB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKGQuZ2V0VGltZSgpICsgdGhpcy5taWxsaXNlY29uZHMpO1xuICB9XG5cbiAgZm9ybWF0KGxheW91dDogRHVyYXRpb25MYXlvdXQgPSAnZGVmYXVsdCcpOiBzdHJpbmcge1xuICAgIGlmIChsYXlvdXQgPT09ICdkZWZhdWx0JyB8fCBsYXlvdXQgPT09ICdkZWZhdWx0LWhvdXJzJykge1xuICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcobGF5b3V0ID09PSAnZGVmYXVsdC1ob3VycycpO1xuICAgIH1cblxuICAgIGNvbnN0IHNpZ24gPSB0aGlzLl9uYW5vc2Vjb25kcyA8IDAgPyAnLScgOiAnJztcbiAgICBsZXQgbnMgPSBNYXRoLmFicyh0aGlzLl9uYW5vc2Vjb25kcyk7XG4gICAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKG5zIC8gaG91cik7XG4gICAgbnMgLT0gaG91cnMgKiBob3VyO1xuICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKG5zIC8gbWludXRlKTtcbiAgICBucyAtPSBtaW51dGVzICogbWludXRlO1xuICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKG5zIC8gc2Vjb25kKTtcbiAgICBucyAtPSBzZWNvbmRzICogc2Vjb25kO1xuXG4gICAgbGV0IHN0ciA9IHBhZExlZnQoaG91cnMudG9TdHJpbmcoKSwgMiwgJzAnKSArICc6JyArIHBhZExlZnQobWludXRlcy50b1N0cmluZygpLCAyLCAnMCcpO1xuICAgIGlmIChsYXlvdXQgPT09ICdoaDptbTpzcycpIHtcbiAgICAgIHN0ciArPSAnOicgKyBwYWRMZWZ0KHNlY29uZHMudG9TdHJpbmcoKSwgMiwgJzAnKTtcbiAgICB9XG4gICAgcmV0dXJuIHNpZ24rc3RyO1xuICB9XG5cbiAgdG9TdHJpbmcoc2tpcERheXMgPSBmYWxzZSk6IHN0cmluZyB7XG4gICAgY29uc3Qgc2lnbiA9IHRoaXMuX25hbm9zZWNvbmRzIDwgMCA/ICctJyA6ICcnO1xuICAgIGxldCBucyA9IE1hdGguYWJzKHRoaXMuX25hbm9zZWNvbmRzKTtcbiAgICBsZXQgc3RyID0gJyc7XG5cbiAgICBpZiAodGhpcy5fbmFub3NlY29uZHMgPT09IDApIHtcbiAgICAgIHJldHVybiAnMGgnO1xuICAgIH1cblxuICAgIGlmICghc2tpcERheXMpIHtcbiAgICAgIGNvbnN0IGRheXMgPSBNYXRoLmZsb29yKG5zIC8gZGF5KVxuICAgICAgaWYgKGRheXMgPiAwKSB7XG4gICAgICAgIHN0ciArPSBkYXlzLnRvU3RyaW5nKCkgKyAnZCAnO1xuICAgICAgICBucyAtPSBkYXlzICogZGF5O1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihucyAvIGhvdXIpO1xuICAgIGlmIChob3VycyA+IDApIHtcbiAgICAgIHN0ciArPSBob3Vycy50b1N0cmluZygpICsgJ2ggJztcbiAgICAgIG5zIC09IGhvdXJzICogaG91cjtcbiAgICB9XG5cbiAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcihucyAvIG1pbnV0ZSk7XG4gICAgaWYgKG1pbnV0ZXMgPiAwKSB7XG4gICAgICBzdHIgKz0gbWludXRlcy50b1N0cmluZygpICsgJ20gJztcbiAgICAgIG5zIC09IG1pbnV0ZXMgKiBtaW51dGU7XG4gICAgfVxuXG4gICAgY29uc3Qgc2Vjb25kcyA9IE1hdGguZmxvb3IobnMgLyBzZWNvbmQpO1xuICAgIGlmIChzZWNvbmRzID4gMCkge1xuICAgICAgc3RyICs9IHNlY29uZHMudG9TdHJpbmcoKSArICdzICc7XG4gICAgICBucyAtPSBzZWNvbmRzICogc2Vjb25kO1xuICAgIH1cblxuICAgIGNvbnN0IG1pbGxpc2Vjb25kcyA9IE1hdGguZmxvb3IobnMgLyBtaWxsaXNlY29uZCk7XG4gICAgaWYgKG1pbGxpc2Vjb25kcyA+IDApIHtcbiAgICAgIHN0ciArPSBtaWxsaXNlY29uZHMudG9TdHJpbmcoKSArICdtcyAnO1xuICAgICAgbnMgLT0gbWlsbGlzZWNvbmRzICogbWlsbGlzZWNvbmQ7XG4gICAgfVxuXG4gICAgY29uc3QgbWljcm9zZWNvbmRzID0gTWF0aC5mbG9vcihucyAvIG1pY3Jvc2Vjb25kKTtcbiAgICBpZiAobWljcm9zZWNvbmRzID4gMCkge1xuICAgICAgc3RyICs9IG1pY3Jvc2Vjb25kcy50b1N0cmluZygpICsgJ8K1cyAnO1xuICAgICAgbnMgLT0gbWljcm9zZWNvbmRzICogbWljcm9zZWNvbmQ7XG4gICAgfVxuXG4gICAgaWYgKG5zID4gMCkge1xuICAgICAgc3RyICs9IG5zLnRvU3RyaW5nKCkgKyAnbnMnO1xuICAgICAgbnMgLT0gbnMgKiBuYW5vc2Vjb25kO1xuICAgIH1cblxuICAgIGlmIChzdHIuZW5kc1dpdGgoXCJcIikpIHtcbiAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgc3RyLmxlbmd0aCAtIDEpXG4gICAgfVxuXG4gICAgcmV0dXJuIHNpZ24gKyBzdHI7XG4gIH1cblxuICBzdGF0aWMgcGFyc2VTdHJpbmcodjogc3RyaW5nKTogRHVyYXRpb24ge1xuICAgIGxldCB0aW1lID0gMDtcblxuICAgIGxldCBudW1iZXJWYWx1ZSA9ICcnO1xuICAgIGxldCBzdWZmaXggPSAnJztcbiAgICBsZXQgc3RhdGUgPSAnbnVtYmVyJ1xuICAgIGxldCBwYXJzZUZhY3RvciA9IDE7XG5cbiAgICBjb25zdCBwYXJzZSA9ICgpID0+IHtcbiAgICAgIGxldCBmYWN0b3IgPSAwO1xuICAgICAgc3dpdGNoIChzdWZmaXgpIHtcbiAgICAgICAgY2FzZSAnZCc6XG4gICAgICAgICAgZmFjdG9yID0gZGF5XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2gnOlxuICAgICAgICAgIGZhY3RvciA9IGhvdXJcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbSc6XG4gICAgICAgICAgZmFjdG9yID0gbWludXRlXG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3MnOlxuICAgICAgICAgIGZhY3RvciA9IHNlY29uZFxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdtcyc6XG4gICAgICAgICAgZmFjdG9yID0gbWlsbGlzZWNvbmRcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnwrVzJzpcbiAgICAgICAgICBmYWN0b3IgPSBtaWNyb3NlY29uZFxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICducyc6XG4gICAgICAgICAgZmFjdG9yID0gbmFub3NlY29uZFxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZCB0aW1lIGZhY3RvcjogJHtzdWZmaXh9YClcbiAgICAgIH1cblxuICAgICAgdGltZSArPSAoKCtudW1iZXJWYWx1ZSkgKiBmYWN0b3IpXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdi5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBjID0gdi5jaGFyQXQoaSlcblxuICAgICAgICBpZiAoYyA9PT0gJyAnKSB7XG4gICAgICAgICAgY29udGludWVcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjID09PSAnLScgJiYgbnVtYmVyVmFsdWUgPT09ICcnKSB7XG4gICAgICAgICAgcGFyc2VGYWN0b3IgPSAtMVxuXG4gICAgICAgICAgY29udGludWVcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdGF0ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICBpZiAoIWlzTmFOKCtjKSkge1xuICAgICAgICAgICAgbnVtYmVyVmFsdWUgKz0gY1xuXG4gICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHN0YXRlID0gJ3N1ZmZpeCdcbiAgICAgICAgICBzdWZmaXggKz0gY1xuXG4gICAgICAgICAgY29udGludWVcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdGF0ZSA9PT0gJ3N1ZmZpeCcpIHtcbiAgICAgICAgICBpZiAoaXNOYU4oK2MpKSB7XG4gICAgICAgICAgICBzdWZmaXggKz0gY1xuICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwYXJzZSgpXG5cbiAgICAgICAgICBudW1iZXJWYWx1ZSA9IGNcbiAgICAgICAgICBzdWZmaXggPSAnJ1xuICAgICAgICAgIHN0YXRlID0gJ251bWJlcidcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAobnVtYmVyVmFsdWUgIT09ICcnKSB7XG4gICAgICAgIHBhcnNlKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyBEdXJhdGlvbihwYXJzZUZhY3RvciAqIHRpbWUpXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByZXR1cm4gbmV3IER1cmF0aW9uKDApXG4gICAgfVxuICB9XG5cbiAgaXNMZXNzVGhhbihkOiBEdXJhdGlvbikge1xuICAgIHJldHVybiB0aGlzLm5hbm9zZWNvbmRzIDwgZC5uYW5vc2Vjb25kcztcbiAgfVxuXG4gIGlzR3JlYXRoZXJUaGFuKGQ6IER1cmF0aW9uKSB7XG4gICAgcmV0dXJuIHRoaXMubmFub3NlY29uZHMgPiBkLm5hbm9zZWNvbmRzO1xuICB9XG5cbiAgaXNFcXVhbChkOiBEdXJhdGlvbikge1xuICAgIHJldHVybiB0aGlzLm5hbm9zZWNvbmRzID09PSBkLm5hbm9zZWNvbmRzO1xuICB9XG5cbiAgdmFsdWVPZigpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9uYW5vc2Vjb25kcztcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RGF0ZShkOiBEYXRlIHwgc3RyaW5nIHwgbnVsbCwgc2VwID0gJy0nKTogc3RyaW5nIHtcbiAgaWYgKGQgPT09IG51bGwpIHtcbiAgICByZXR1cm4gJydcbiAgfVxuXG4gIGQgPSBuZXcgRGF0ZShkKVxuICBsZXQgbW9udGggPSAnJyArIChkLmdldE1vbnRoKCkgKyAxKVxuICBsZXQgZGF5ID0gJycgKyBkLmdldERhdGUoKVxuICBsZXQgeWVhciA9IGQuZ2V0RnVsbFllYXIoKVxuXG4gIGlmIChtb250aC5sZW5ndGggPCAyKVxuICAgIG1vbnRoID0gJzAnICsgbW9udGg7XG4gIGlmIChkYXkubGVuZ3RoIDwgMilcbiAgICBkYXkgPSAnMCcgKyBkYXk7XG5cbiAgcmV0dXJuIFt5ZWFyLCBtb250aCwgZGF5XS5qb2luKHNlcCk7XG59XG4iXX0=