{"version":3,"file":"tkd-angular.mjs","sources":["../../dev/projects/angular/src/user.pipes.ts","../../dev/projects/angular/src/to-date.pipe.ts","../../dev/projects/angular/src/tkd-angular.ts"],"sourcesContent":["import { Pipe, PipeTransform } from \"@angular/core\";\nimport { Profile, User } from \"@tkd/apis\";\n\nenum UserExtraKey {\n  CalendarID = \"calendarId\",\n  Color = \"color\",\n}\n\ninterface UserProfile extends Profile {\n  user: User & {\n    extra: {\n      fields: {\n        [UserExtraKey.CalendarID]?: {\n          kind: {\n            case: 'stringValue';\n            value: string,\n          }\n        },\n        [UserExtraKey.Color]?: {\n          kind: {\n            case: 'stringValue';\n            value: string,\n          }\n        },\n      }\n    }\n  }\n}\n\nfunction parseColor(input: string): number[] {\n  if (input.substr(0, 1) === '#') {\n    const collen = (input.length - 1) / 3;\n    const fact = [17, 1, 0.062272][collen - 1];\n    return [\n      Math.round(parseInt(input.substr(1, collen), 16) * fact),\n      Math.round(parseInt(input.substr(1 + collen, collen), 16) * fact),\n      Math.round(parseInt(input.substr(1 + 2 * collen, collen), 16) * fact),\n    ];\n  }\n\n  return input\n    .split('(')[1]\n    .split(')')[0]\n    .split(',')\n    .map((x) => +x);\n}\n\nfunction getContrastFontColor(bgColor: string): string {\n  // if (red*0.299 + green*0.587 + blue*0.114) > 186 use #000000 else use #ffffff\n  // based on https://stackoverflow.com/a/3943023\n\n  let col = bgColor;\n  if (bgColor.startsWith('#') && bgColor.length > 7) {\n    col = bgColor.slice(0, 7);\n  }\n  const [r, g, b] = parseColor(col);\n\n  if (r * 0.299 + g * 0.587 + b * 0.114 > 186) {\n    return '#000000';\n  }\n\n  return '#ffffff';\n}\n\nexport function getUserColor(profile: UserProfile | Profile): string | null {\n  const prop = profile?.user?.extra?.fields[UserExtraKey.Color];\n\n  if (!prop || prop.kind.case !== 'stringValue') {\n    return null\n  }\n\n  return prop.kind.value;\n}\n\n@Pipe({\n    name: 'displayName',\n    pure: true\n})\nexport class UserNamePipe implements PipeTransform {\n    static transform(value?: Profile, ...args: any[]) {\n        return value?.user?.displayName || value?.user?.username;\n    }\n\n    transform(value?: Profile, ...args: any[]) {\n      return UserNamePipe.transform(value, args);\n    }\n}\n\n@Pipe({\n    name: 'color',\n    pure: true\n})\nexport class UserColorPipe implements PipeTransform {\n    transform(value: Profile, ...args: any[]) {\n      return getUserColor(value)\n    }\n}\n\n@Pipe({\n    name: 'contrastColor',\n    pure: true\n})\nexport class UserContrastColorPipe implements PipeTransform {\n    transform(value: Profile, ...args: any[]) {\n      return getContrastFontColor(getUserColor(value) || '#ffffff')\n    }\n}\n","import { Timestamp } from '@bufbuild/protobuf';\nimport { Pipe, PipeTransform } from \"@angular/core\";\n\n@Pipe({\n  name: 'toDate',\n  pure: true\n})\nexport class ToDatePipe implements PipeTransform {\n  transform(value: Timestamp | Date | string | number, ...args: any[]): Date {\n    if (value instanceof Timestamp) {\n      value = value.toDate();\n    }\n\n    if (typeof value === 'string') {\n      value = new Date(value)\n    }\n\n    if (typeof value === 'number') {\n      value = new Date(value * 1000)\n    }\n\n    return value;\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}